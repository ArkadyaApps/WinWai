<analysis>
The previous AI engineer developed the WinWai Raffle Rewards Thailand mobile application from scratch, moving from initial setup (0 to 1) to a functional MVP. This included establishing a React Native/Expo frontend, FastAPI backend, and MongoDB database, alongside Firebase Authentication and AdMob integration. Key achievements were implementing a 3-column grid UI, location-based filtering, multi-language support, and robust AdMob Server-Side Verification. Challenges involved resolving AdMob web incompatibility and duplicate package issues. Recent work focused on implementing admin CRUD endpoints (Partners, Users, Raffles) and making the user profile editable. Significant effort was dedicated to fixing critical issues: persistent login (implementing route protection), broken profile links, non-functional logout, and language settings. The AdMob Rewarded Ad integration on the Tickets page was also enhanced. The primary unresolved issue is the Expo Go app failing to launch due to a , likely stemming from an Expo configuration error where the manifest endpoint returns HTML instead of JSON.
</analysis>

<product_requirements>
The WinWai Raffle Rewards Thailand mobile application aims to provide free raffles (meals, hotel stays, spa) in Thailand, monetized by AdMob rewarded ads, engagement, and referrals, without gambling. Core features include Firebase Authentication (Google, Email/Password), raffle creation with prizes and draw dates, and a ticket system where users earn tickets from ads, daily logins, and referrals. It requires a randomized draw, in-app winner notifications, and a My Rewards tab. An admin dashboard is necessary for managing partners, users, raffles, and prizes. UI/UX should be clean, Thai-inspired (gold, white, green), with clear tab navigation (Home, Raffles, Tickets, Rewards, Profile) and an onboarding carousel. Subsequent additions included a 3-column raffle grid, logo, stock photos, shadows, location-based offers via , a search by category/location, a detailed product page, and a language selector with geolocation.
</product_requirements>

<key_technical_concepts>
- **Frontend:** React Native (Expo, Expo Router for file-based routing), Zustand (state management), React Navigation.
- **Backend:** FastAPI (Python), MongoDB.
- **Authentication:** Firebase Authentication (Google, Email/Password), Google OAuth.
- **Monetization:** Google AdMob SDK (Rewarded, Interstitial, Banner Ads).
- **Geolocation:** .
- **UI/UX:** Component-based design, base64 image handling.
</key_technical_concepts>

<code_architecture>
The application uses a full-stack architecture with React Native (Expo) for the frontend, FastAPI for the backend, and MongoDB as the database.



-   **/app/backend/server.py**:
    -   **Importance:** Defines all API endpoints and MongoDB models.
    -   **Changes:** Expanded user profile updates (added phone field), and comprehensive admin CRUD endpoints for Partners, Users, and Raffles.
-   **/app/backend/populate_mock_data.py**:
    -   **Importance:** Populates MongoDB with mock data.
    -   **Changes:** Updated to include detailed location data for raffles and partners, and three admin user accounts.
-   **/app/frontend/app.json**:
    -   **Importance:** Expo configuration file for metadata, plugins, deep linking.
    -   **Changes:** Configured AdMob plugin, , ,  for deep linking and Google OAuth redirect.
-   **/app/frontend/app/_layout.tsx**:
    -   **Importance:** Root layout for Expo Router.
    -   **Changes:** Initial setup for AuthProvider and navigation container.
-   **/app/frontend/app/(tabs)/_layout.tsx**:
    -   **Importance:** Defines tab navigation.
    -   **Changes:** Implemented authentication check to prevent unauthenticated access to main tabs, redirecting to the index (login) page.
-   **/app/frontend/app/(tabs)/home.tsx**:
    -   **Importance:** Main home screen.
    -   **Changes:** Redesigned with 3-column grid, integrated , , , .
-   **/app/frontend/app/(tabs)/profile.tsx**:
    -   **Importance:** User profile screen.
    -   **Changes:** Made user profile fields (name, email, phone) editable via a modal. Added an Edit Profile button, implemented handlers for profile updates, notifications, and language settings. Added a language selection modal and fixed the logout functionality, ensuring proper state clearing and redirection.
-   **/app/frontend/app/index.tsx**:
    -   **Importance:** Initial login/authentication screen.
    -   **Changes:** Initial setup for Google and Email/Password login.
-   **/app/frontend/app/raffle/[id].tsx**:
    -   **Importance:** Detailed product page.
    -   **Changes:** Displays comprehensive raffle details.
-   **/app/frontend/app/(tabs)/tickets.tsx**:
    -   **Importance:** Screen for earning/managing tickets.
    -   **Changes:** Enhanced with a more prominent Play Ad button for watching rewarded ads.
-   **/app/frontend/app/admin/_layout.tsx**:
    -   **Importance:** Layout for admin screens.
    -   **Changes:** Created to add route protection for admin-specific paths.
-   **/app/frontend/app/admin/partners.tsx**:
    -   **Importance:** Admin management screen for partners.
    -   **Changes:** Created as a placeholder for partner management.
-   **/app/frontend/app/admin/users.tsx**:
    -   **Importance:** Admin management screen for users.
    -   **Changes:** Created as a placeholder for user management.
-   **/app/frontend/app/admin/raffles.tsx**:
    -   **Importance:** Admin management screen for raffles.
    -   **Changes:** Created as a placeholder for raffle management, with a fix for a typo in the endpoint path.
-   **/app/frontend/src/store/userStore.ts**:
    -   **Importance:** Manages user authentication state.
    -   **Changes:**  function updated for robustness.
-   **/app/frontend/src/store/languageStore.ts**:
    -   **Importance:** Manages language state.
    -   **Changes:** Integrated with the profile page for language selection.
-   **/app/frontend/src/types/index.ts**:
    -   **Importance:** Defines TypeScript interfaces.
    -   **Changes:** Updated  interface to include  field, and  interface to include  and .
-   **/app/frontend/src/managers/RewardedAdManager.ts**:
    -   **Importance:** Manages AdMob rewarded ads.
    -   **Changes:** Implemented proper AdMob loading and showing functionality.
</code_architecture>

<pending_tasks>
- Fix the Expo Go application launch issue () which is currently preventing the app from running on mobile devices.
- Fully implement CRUD operations for Partners, Users, and Raffles in the admin management screens.
</pending_tasks>

<current_work>
The WinWai Raffle Rewards Thailand mobile application has an operational full-stack. The backend features robust user authentication, raffle, partner, ticket, and reward management, including a fully functional AdMob SSV endpoint. Hardcoded URLs have been replaced by environment variables.

The frontend, using Expo Router, provides a tab-based interface. Authentication is now enforced, preventing unauthenticated access to core app features. The user profile page is editable, allowing updates to name, email, and phone, and includes a functional language selector and a robust logout mechanism. Admin management screens for Partners, Users, and Raffles have been created, though their full CRUD functionality is pending. The Tickets page has an enhanced Play Ad button integrated with the  for AdMob ads.

However, a critical issue persists: the Expo Go app fails to launch on mobile devices with a failed to download remote update error. This appears to be an Expo configuration issue where the manifest endpoint serves HTML instead of JSON. The web preview works, but native testing is currently blocked.
</current_work>

<optional_next_step>
Investigate and resolve the Expo Go application launch issue where the manifest endpoint returns HTML instead of JSON.
</optional_next_step>
