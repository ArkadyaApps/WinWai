{"dependencies":[{"name":"@babel/runtime/helpers/interopRequireDefault","data":{"asyncType":null,"locs":[{"start":{"line":1,"column":0,"index":0},"end":{"line":180,"column":0,"index":5039}}],"key":"7kvm5yrOpz4NYiDi6sn4qxa8DVQ="}},{"name":"./NativeBlobModule","data":{"asyncType":null,"locs":[{"start":{"line":13,"column":0,"index":300},"end":{"line":13,"column":50,"index":350}}],"key":"8yhexf66+KMPl6M2NPjj2sFxaVw="}},{"name":"invariant","data":{"asyncType":null,"locs":[{"start":{"line":14,"column":0,"index":351},"end":{"line":14,"column":34,"index":385}}],"key":"Fzi/BpZws2YooIGJ9b6u0HJtuks="}},{"name":"./Blob","data":{"asyncType":null,"locs":[{"start":{"line":16,"column":13,"index":400},"end":{"line":16,"column":30,"index":417}}],"key":"EbjXBySE25qcfnrYju25x5GaG3k="}},{"name":"./BlobRegistry","data":{"asyncType":null,"locs":[{"start":{"line":17,"column":21,"index":440},"end":{"line":17,"column":46,"index":465}}],"key":"J79JGfKe/FiysxfBPf87zeBV7Ns="}}],"output":[{"data":{"code":"__d(function (global, require, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  var _interopRequireDefault = require(_dependencyMap[0], \"@babel/runtime/helpers/interopRequireDefault\");\n  var _NativeBlobModule = _interopRequireDefault(require(_dependencyMap[1], \"./NativeBlobModule\"));\n  var _invariant = _interopRequireDefault(require(_dependencyMap[2], \"invariant\"));\n  /**\n   * Copyright (c) Meta Platforms, Inc. and affiliates.\n   *\n   * This source code is licensed under the MIT license found in the\n   * LICENSE file in the root directory of this source tree.\n   *\n   * \n   * @format\n   */\n\n  const Blob = require(_dependencyMap[3], \"./Blob\");\n  const BlobRegistry = require(_dependencyMap[4], \"./BlobRegistry\");\n\n  /*eslint-disable no-bitwise */\n  /*eslint-disable eqeqeq */\n\n  /**\n   * Based on the rfc4122-compliant solution posted at\n   * http://stackoverflow.com/questions/105034\n   */\n  function uuidv4() {\n    return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, c => {\n      const r = Math.random() * 16 | 0,\n        v = c == 'x' ? r : r & 0x3 | 0x8;\n      return v.toString(16);\n    });\n  }\n\n  // **Temporary workaround**\n  // TODO(#24654): Use turbomodules for the Blob module.\n  // Blob collector is a jsi::HostObject that is used by native to know\n  // when the a Blob instance is deallocated. This allows to free the\n  // underlying native resources. This is a hack to workaround the fact\n  // that the current bridge infra doesn't allow to track js objects\n  // deallocation. Ideally the whole Blob object should be a jsi::HostObject.\n  function createBlobCollector(blobId) {\n    if (global.__blobCollectorProvider == null) {\n      return null;\n    } else {\n      return global.__blobCollectorProvider(blobId);\n    }\n  }\n\n  /**\n   * Module to manage blobs. Wrapper around the native blob module.\n   */\n  class BlobManager {\n    /**\n     * If the native blob module is available.\n     */\n    static isAvailable = !!_NativeBlobModule.default;\n\n    /**\n     * Create blob from existing array of blobs.\n     */\n    static createFromParts(parts, options) {\n      (0, _invariant.default)(_NativeBlobModule.default, 'NativeBlobModule is available.');\n      const blobId = uuidv4();\n      const items = parts.map(part => {\n        if (part instanceof ArrayBuffer || ArrayBuffer.isView(part)) {\n          throw new Error(\"Creating blobs from 'ArrayBuffer' and 'ArrayBufferView' are not supported\");\n        }\n        if (part instanceof Blob) {\n          return {\n            data: part.data,\n            type: 'blob'\n          };\n        } else {\n          return {\n            data: String(part),\n            type: 'string'\n          };\n        }\n      });\n      const size = items.reduce((acc, curr) => {\n        if (curr.type === 'string') {\n          return acc + global.unescape(encodeURI(curr.data)).length;\n        } else {\n          return acc + curr.data.size;\n        }\n      }, 0);\n      _NativeBlobModule.default.createFromParts(items, blobId);\n      return BlobManager.createFromOptions({\n        blobId,\n        offset: 0,\n        size,\n        type: options ? options.type : '',\n        lastModified: options ? options.lastModified : Date.now()\n      });\n    }\n\n    /**\n     * Create blob instance from blob data from native.\n     * Used internally by modules like XHR, WebSocket, etc.\n     */\n    static createFromOptions(options) {\n      BlobRegistry.register(options.blobId);\n      // $FlowFixMe[prop-missing]\n      return Object.assign(Object.create(Blob.prototype), {\n        data:\n        // Reuse the collector instance when creating from an existing blob.\n        // This will make sure that the underlying resource is only deallocated\n        // when all blobs that refer to it are deallocated.\n        options.__collector == null ? {\n          ...options,\n          __collector: createBlobCollector(options.blobId)\n        } : options\n      });\n    }\n\n    /**\n     * Deallocate resources for a blob.\n     */\n    static release(blobId) {\n      (0, _invariant.default)(_NativeBlobModule.default, 'NativeBlobModule is available.');\n      BlobRegistry.unregister(blobId);\n      if (BlobRegistry.has(blobId)) {\n        return;\n      }\n      _NativeBlobModule.default.release(blobId);\n    }\n\n    /**\n     * Inject the blob content handler in the networking module to support blob\n     * requests and responses.\n     */\n    static addNetworkingHandler() {\n      (0, _invariant.default)(_NativeBlobModule.default, 'NativeBlobModule is available.');\n      _NativeBlobModule.default.addNetworkingHandler();\n    }\n\n    /**\n     * Indicate the websocket should return a blob for incoming binary\n     * messages.\n     */\n    static addWebSocketHandler(socketId) {\n      (0, _invariant.default)(_NativeBlobModule.default, 'NativeBlobModule is available.');\n      _NativeBlobModule.default.addWebSocketHandler(socketId);\n    }\n\n    /**\n     * Indicate the websocket should no longer return a blob for incoming\n     * binary messages.\n     */\n    static removeWebSocketHandler(socketId) {\n      (0, _invariant.default)(_NativeBlobModule.default, 'NativeBlobModule is available.');\n      _NativeBlobModule.default.removeWebSocketHandler(socketId);\n    }\n\n    /**\n     * Send a blob message to a websocket.\n     */\n    static sendOverSocket(blob, socketId) {\n      (0, _invariant.default)(_NativeBlobModule.default, 'NativeBlobModule is available.');\n      _NativeBlobModule.default.sendOverSocket(blob.data, socketId);\n    }\n  }\n  module.exports = BlobManager;\n});","lineCount":163,"map":[[3,2,13,0],[3,6,13,0,"_NativeBlobModule"],[3,23,13,0],[3,26,13,0,"_interopRequireDefault"],[3,48,13,0],[3,49,13,0,"require"],[3,56,13,0],[3,57,13,0,"_dependencyMap"],[3,71,13,0],[4,2,14,0],[4,6,14,0,"_invariant"],[4,16,14,0],[4,19,14,0,"_interopRequireDefault"],[4,41,14,0],[4,42,14,0,"require"],[4,49,14,0],[4,50,14,0,"_dependencyMap"],[4,64,14,0],[5,2,1,0],[6,0,2,0],[7,0,3,0],[8,0,4,0],[9,0,5,0],[10,0,6,0],[11,0,7,0],[12,0,8,0],[13,0,9,0],[15,2,16,0],[15,8,16,6,"Blob"],[15,12,16,10],[15,15,16,13,"require"],[15,22,16,20],[15,23,16,20,"_dependencyMap"],[15,37,16,20],[15,50,16,29],[15,51,16,30],[16,2,17,0],[16,8,17,6,"BlobRegistry"],[16,20,17,18],[16,23,17,21,"require"],[16,30,17,28],[16,31,17,28,"_dependencyMap"],[16,45,17,28],[16,66,17,45],[16,67,17,46],[18,2,19,0],[19,2,20,0],[21,2,22,0],[22,0,23,0],[23,0,24,0],[24,0,25,0],[25,2,26,0],[25,11,26,9,"uuidv4"],[25,17,26,15,"uuidv4"],[25,18,26,15],[25,20,26,26],[26,4,27,2],[26,11,27,9],[26,49,27,47],[26,50,27,48,"replace"],[26,57,27,55],[26,58,27,56],[26,65,27,63],[26,67,27,65,"c"],[26,68,27,66],[26,72,27,70],[27,6,28,4],[27,12,28,10,"r"],[27,13,28,11],[27,16,28,15,"Math"],[27,20,28,19],[27,21,28,20,"random"],[27,27,28,26],[27,28,28,27],[27,29,28,28],[27,32,28,31],[27,34,28,33],[27,37,28,37],[27,38,28,38],[28,8,29,6,"v"],[28,9,29,7],[28,12,29,10,"c"],[28,13,29,11],[28,17,29,15],[28,20,29,18],[28,23,29,21,"r"],[28,24,29,22],[28,27,29,26,"r"],[28,28,29,27],[28,31,29,30],[28,34,29,33],[28,37,29,37],[28,40,29,40],[29,6,30,4],[29,13,30,11,"v"],[29,14,30,12],[29,15,30,13,"toString"],[29,23,30,21],[29,24,30,22],[29,26,30,24],[29,27,30,25],[30,4,31,2],[30,5,31,3],[30,6,31,4],[31,2,32,0],[33,2,34,0],[34,2,35,0],[35,2,36,0],[36,2,37,0],[37,2,38,0],[38,2,39,0],[39,2,40,0],[40,2,41,0],[40,11,41,9,"createBlobCollector"],[40,30,41,28,"createBlobCollector"],[40,31,41,29,"blobId"],[40,37,41,43],[40,39,41,67],[41,4,42,2],[41,8,42,6,"global"],[41,14,42,12],[41,15,42,13,"__blobCollectorProvider"],[41,38,42,36],[41,42,42,40],[41,46,42,44],[41,48,42,46],[42,6,43,4],[42,13,43,11],[42,17,43,15],[43,4,44,2],[43,5,44,3],[43,11,44,9],[44,6,45,4],[44,13,45,11,"global"],[44,19,45,17],[44,20,45,18,"__blobCollectorProvider"],[44,43,45,41],[44,44,45,42,"blobId"],[44,50,45,48],[44,51,45,49],[45,4,46,2],[46,2,47,0],[48,2,49,0],[49,0,50,0],[50,0,51,0],[51,2,52,0],[51,8,52,6,"BlobManager"],[51,19,52,17],[51,20,52,18],[52,4,53,2],[53,0,54,0],[54,0,55,0],[55,4,56,2],[55,11,56,9,"isAvailable"],[55,22,56,20],[55,25,56,32],[55,26,56,33],[55,27,56,34,"NativeBlobModule"],[55,52,56,50],[57,4,58,2],[58,0,59,0],[59,0,60,0],[60,4,61,2],[60,11,61,9,"createFromParts"],[60,26,61,24,"createFromParts"],[60,27,62,4,"parts"],[60,32,62,31],[60,34,63,4,"options"],[60,41,63,25],[60,43,64,10],[61,6,65,4],[61,10,65,4,"invariant"],[61,28,65,13],[61,30,65,14,"NativeBlobModule"],[61,55,65,30],[61,57,65,32],[61,89,65,64],[61,90,65,65],[62,6,67,4],[62,12,67,10,"blobId"],[62,18,67,16],[62,21,67,19,"uuidv4"],[62,27,67,25],[62,28,67,26],[62,29,67,27],[63,6,68,4],[63,12,68,10,"items"],[63,17,68,15],[63,20,68,18,"parts"],[63,25,68,23],[63,26,68,24,"map"],[63,29,68,27],[63,30,68,28,"part"],[63,34,68,32],[63,38,68,36],[64,8,69,6],[64,12,69,10,"part"],[64,16,69,14],[64,28,69,26,"ArrayBuffer"],[64,39,69,37],[64,43,69,41,"ArrayBuffer"],[64,54,69,52],[64,55,69,53,"isView"],[64,61,69,59],[64,62,69,60,"part"],[64,66,69,64],[64,67,69,65],[64,69,69,67],[65,10,70,8],[65,16,70,14],[65,20,70,18,"Error"],[65,25,70,23],[65,26,71,10],[65,101,72,8],[65,102,72,9],[66,8,73,6],[67,8,74,6],[67,12,74,10,"part"],[67,16,74,14],[67,28,74,26,"Blob"],[67,32,74,30],[67,34,74,32],[68,10,75,8],[68,17,75,15],[69,12,76,10,"data"],[69,16,76,14],[69,18,76,16,"part"],[69,22,76,20],[69,23,76,21,"data"],[69,27,76,25],[70,12,77,10,"type"],[70,16,77,14],[70,18,77,16],[71,10,78,8],[71,11,78,9],[72,8,79,6],[72,9,79,7],[72,15,79,13],[73,10,80,8],[73,17,80,15],[74,12,81,10,"data"],[74,16,81,14],[74,18,81,16,"String"],[74,24,81,22],[74,25,81,23,"part"],[74,29,81,27],[74,30,81,28],[75,12,82,10,"type"],[75,16,82,14],[75,18,82,16],[76,10,83,8],[76,11,83,9],[77,8,84,6],[78,6,85,4],[78,7,85,5],[78,8,85,6],[79,6,86,4],[79,12,86,10,"size"],[79,16,86,14],[79,19,86,17,"items"],[79,24,86,22],[79,25,86,23,"reduce"],[79,31,86,29],[79,32,86,30],[79,33,86,31,"acc"],[79,36,86,34],[79,38,86,36,"curr"],[79,42,86,40],[79,47,86,45],[80,8,87,6],[80,12,87,10,"curr"],[80,16,87,14],[80,17,87,15,"type"],[80,21,87,19],[80,26,87,24],[80,34,87,32],[80,36,87,34],[81,10,88,8],[81,17,88,15,"acc"],[81,20,88,18],[81,23,88,21,"global"],[81,29,88,27],[81,30,88,28,"unescape"],[81,38,88,36],[81,39,88,37,"encodeURI"],[81,48,88,46],[81,49,88,47,"curr"],[81,53,88,51],[81,54,88,52,"data"],[81,58,88,56],[81,59,88,57],[81,60,88,58],[81,61,88,59,"length"],[81,67,88,65],[82,8,89,6],[82,9,89,7],[82,15,89,13],[83,10,90,8],[83,17,90,15,"acc"],[83,20,90,18],[83,23,90,21,"curr"],[83,27,90,25],[83,28,90,26,"data"],[83,32,90,30],[83,33,90,31,"size"],[83,37,90,35],[84,8,91,6],[85,6,92,4],[85,7,92,5],[85,9,92,7],[85,10,92,8],[85,11,92,9],[86,6,94,4,"NativeBlobModule"],[86,31,94,20],[86,32,94,21,"createFromParts"],[86,47,94,36],[86,48,94,37,"items"],[86,53,94,42],[86,55,94,44,"blobId"],[86,61,94,50],[86,62,94,51],[87,6,96,4],[87,13,96,11,"BlobManager"],[87,24,96,22],[87,25,96,23,"createFromOptions"],[87,42,96,40],[87,43,96,41],[88,8,97,6,"blobId"],[88,14,97,12],[89,8,98,6,"offset"],[89,14,98,12],[89,16,98,14],[89,17,98,15],[90,8,99,6,"size"],[90,12,99,10],[91,8,100,6,"type"],[91,12,100,10],[91,14,100,12,"options"],[91,21,100,19],[91,24,100,22,"options"],[91,31,100,29],[91,32,100,30,"type"],[91,36,100,34],[91,39,100,37],[91,41,100,39],[92,8,101,6,"lastModified"],[92,20,101,18],[92,22,101,20,"options"],[92,29,101,27],[92,32,101,30,"options"],[92,39,101,37],[92,40,101,38,"lastModified"],[92,52,101,50],[92,55,101,53,"Date"],[92,59,101,57],[92,60,101,58,"now"],[92,63,101,61],[92,64,101,62],[93,6,102,4],[93,7,102,5],[93,8,102,6],[94,4,103,2],[96,4,105,2],[97,0,106,0],[98,0,107,0],[99,0,108,0],[100,4,109,2],[100,11,109,9,"createFromOptions"],[100,28,109,26,"createFromOptions"],[100,29,109,27,"options"],[100,36,109,44],[100,38,109,52],[101,6,110,4,"BlobRegistry"],[101,18,110,16],[101,19,110,17,"register"],[101,27,110,25],[101,28,110,26,"options"],[101,35,110,33],[101,36,110,34,"blobId"],[101,42,110,40],[101,43,110,41],[102,6,111,4],[103,6,112,4],[103,13,112,11,"Object"],[103,19,112,17],[103,20,112,18,"assign"],[103,26,112,24],[103,27,112,25,"Object"],[103,33,112,31],[103,34,112,32,"create"],[103,40,112,38],[103,41,112,39,"Blob"],[103,45,112,43],[103,46,112,44,"prototype"],[103,55,112,53],[103,56,112,54],[103,58,112,56],[104,8,113,6,"data"],[104,12,113,10],[105,8,114,8],[106,8,115,8],[107,8,116,8],[108,8,117,8,"options"],[108,15,117,15],[108,16,117,16,"__collector"],[108,27,117,27],[108,31,117,31],[108,35,117,35],[108,38,118,12],[109,10,119,14],[109,13,119,17,"options"],[109,20,119,24],[110,10,120,14,"__collector"],[110,21,120,25],[110,23,120,27,"createBlobCollector"],[110,42,120,46],[110,43,120,47,"options"],[110,50,120,54],[110,51,120,55,"blobId"],[110,57,120,61],[111,8,121,12],[111,9,121,13],[111,12,122,12,"options"],[112,6,123,4],[112,7,123,5],[112,8,123,6],[113,4,124,2],[115,4,126,2],[116,0,127,0],[117,0,128,0],[118,4,129,2],[118,11,129,9,"release"],[118,18,129,16,"release"],[118,19,129,17,"blobId"],[118,25,129,31],[118,27,129,39],[119,6,130,4],[119,10,130,4,"invariant"],[119,28,130,13],[119,30,130,14,"NativeBlobModule"],[119,55,130,30],[119,57,130,32],[119,89,130,64],[119,90,130,65],[120,6,132,4,"BlobRegistry"],[120,18,132,16],[120,19,132,17,"unregister"],[120,29,132,27],[120,30,132,28,"blobId"],[120,36,132,34],[120,37,132,35],[121,6,133,4],[121,10,133,8,"BlobRegistry"],[121,22,133,20],[121,23,133,21,"has"],[121,26,133,24],[121,27,133,25,"blobId"],[121,33,133,31],[121,34,133,32],[121,36,133,34],[122,8,134,6],[123,6,135,4],[124,6,136,4,"NativeBlobModule"],[124,31,136,20],[124,32,136,21,"release"],[124,39,136,28],[124,40,136,29,"blobId"],[124,46,136,35],[124,47,136,36],[125,4,137,2],[127,4,139,2],[128,0,140,0],[129,0,141,0],[130,0,142,0],[131,4,143,2],[131,11,143,9,"addNetworkingHandler"],[131,31,143,29,"addNetworkingHandler"],[131,32,143,29],[131,34,143,38],[132,6,144,4],[132,10,144,4,"invariant"],[132,28,144,13],[132,30,144,14,"NativeBlobModule"],[132,55,144,30],[132,57,144,32],[132,89,144,64],[132,90,144,65],[133,6,146,4,"NativeBlobModule"],[133,31,146,20],[133,32,146,21,"addNetworkingHandler"],[133,52,146,41],[133,53,146,42],[133,54,146,43],[134,4,147,2],[136,4,149,2],[137,0,150,0],[138,0,151,0],[139,0,152,0],[140,4,153,2],[140,11,153,9,"addWebSocketHandler"],[140,30,153,28,"addWebSocketHandler"],[140,31,153,29,"socketId"],[140,39,153,45],[140,41,153,53],[141,6,154,4],[141,10,154,4,"invariant"],[141,28,154,13],[141,30,154,14,"NativeBlobModule"],[141,55,154,30],[141,57,154,32],[141,89,154,64],[141,90,154,65],[142,6,156,4,"NativeBlobModule"],[142,31,156,20],[142,32,156,21,"addWebSocketHandler"],[142,51,156,40],[142,52,156,41,"socketId"],[142,60,156,49],[142,61,156,50],[143,4,157,2],[145,4,159,2],[146,0,160,0],[147,0,161,0],[148,0,162,0],[149,4,163,2],[149,11,163,9,"removeWebSocketHandler"],[149,33,163,31,"removeWebSocketHandler"],[149,34,163,32,"socketId"],[149,42,163,48],[149,44,163,56],[150,6,164,4],[150,10,164,4,"invariant"],[150,28,164,13],[150,30,164,14,"NativeBlobModule"],[150,55,164,30],[150,57,164,32],[150,89,164,64],[150,90,164,65],[151,6,166,4,"NativeBlobModule"],[151,31,166,20],[151,32,166,21,"removeWebSocketHandler"],[151,54,166,43],[151,55,166,44,"socketId"],[151,63,166,52],[151,64,166,53],[152,4,167,2],[154,4,169,2],[155,0,170,0],[156,0,171,0],[157,4,172,2],[157,11,172,9,"sendOverSocket"],[157,25,172,23,"sendOverSocket"],[157,26,172,24,"blob"],[157,30,172,34],[157,32,172,36,"socketId"],[157,40,172,52],[157,42,172,60],[158,6,173,4],[158,10,173,4,"invariant"],[158,28,173,13],[158,30,173,14,"NativeBlobModule"],[158,55,173,30],[158,57,173,32],[158,89,173,64],[158,90,173,65],[159,6,175,4,"NativeBlobModule"],[159,31,175,20],[159,32,175,21,"sendOverSocket"],[159,46,175,35],[159,47,175,36,"blob"],[159,51,175,40],[159,52,175,41,"data"],[159,56,175,45],[159,58,175,47,"socketId"],[159,66,175,55],[159,67,175,56],[160,4,176,2],[161,2,177,0],[162,2,179,0,"module"],[162,8,179,6],[162,9,179,7,"exports"],[162,16,179,14],[162,19,179,17,"BlobManager"],[162,30,179,28],[163,0,179,29]],"functionMap":{"names":["<global>","uuidv4","xxxxxxxxXxxx4xxxYxxxXxxxxxxxxxxx.replace$argument_1","createBlobCollector","BlobManager","createFromParts","parts.map$argument_0","items.reduce$argument_0","createFromOptions","release","addNetworkingHandler","addWebSocketHandler","removeWebSocketHandler","sendOverSocket"],"mappings":"AAA;ACyB;iECC;GDI;CDC;AGS;CHM;AIK;ECS;4BCO;KDiB;8BEC;KFM;GDW;EIM;GJe;EKK;GLQ;EMM;GNI;EOM;GPI;EQM;GRI;ESK;GTI;CJC"}},"type":"js/module"}]}