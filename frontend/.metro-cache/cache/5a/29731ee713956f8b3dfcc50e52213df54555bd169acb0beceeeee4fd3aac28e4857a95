{"dependencies":[{"name":"react","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":1,"column":0,"index":0},"end":{"line":1,"column":89,"index":89}}],"key":"RtGiGa+/H7VrI7GDQDLhO1UbpU8=","exportNames":["*"],"imports":1}},{"name":"@react-native-async-storage/async-storage","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":2,"column":0,"index":90},"end":{"line":2,"column":69,"index":159}}],"key":"0kSRlooyBOaYM9tlTtK91nq+uds=","exportNames":["*"],"imports":1}},{"name":"expo-web-browser","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":3,"column":0,"index":160},"end":{"line":3,"column":47,"index":207}}],"key":"qFWzf28Sq0474idIhFBHQFboHaY=","exportNames":["*"],"imports":1}},{"name":"../store/userStore","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":4,"column":0,"index":208},"end":{"line":4,"column":50,"index":258}}],"key":"IgQi61grymUjzhOUT2rUJCaLs54=","exportNames":["*"],"imports":1}},{"name":"../utils/api","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":5,"column":0,"index":259},"end":{"line":5,"column":31,"index":290}}],"key":"XoJ+jbKCrEi38eKczMqtlbk+TCk=","exportNames":["*"],"imports":1}},{"name":"react/jsx-dev-runtime","data":{"asyncType":null,"isESMImport":false,"locs":[],"key":"L9D70Z4hi4aGuui1ysja/oQ5ytI=","exportNames":["*"],"imports":1}}],"output":[{"data":{"code":"__d(function (global, require, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  \"use strict\";\n\n  var _jsxFileName = \"/app/frontend/src/contexts/AuthContext.tsx\";\n  Object.defineProperty(exports, '__esModule', {\n    value: true\n  });\n  function _interopDefault(e) {\n    return e && e.__esModule ? e : {\n      default: e\n    };\n  }\n  function _interopNamespace(e) {\n    if (e && e.__esModule) return e;\n    var n = {};\n    if (e) Object.keys(e).forEach(function (k) {\n      var d = Object.getOwnPropertyDescriptor(e, k);\n      Object.defineProperty(n, k, d.get ? d : {\n        enumerable: true,\n        get: function () {\n          return e[k];\n        }\n      });\n    });\n    n.default = e;\n    return n;\n  }\n  Object.defineProperty(exports, \"AuthProvider\", {\n    enumerable: true,\n    get: function () {\n      return AuthProvider;\n    }\n  });\n  Object.defineProperty(exports, \"useAuth\", {\n    enumerable: true,\n    get: function () {\n      return useAuth;\n    }\n  });\n  var _react = require(_dependencyMap[0], \"react\");\n  var _reactNativeAsyncStorageAsyncStorage = require(_dependencyMap[1], \"@react-native-async-storage/async-storage\");\n  var AsyncStorage = _interopDefault(_reactNativeAsyncStorageAsyncStorage);\n  var _expoWebBrowser = require(_dependencyMap[2], \"expo-web-browser\");\n  var WebBrowser = _interopNamespace(_expoWebBrowser);\n  var _storeUserStore = require(_dependencyMap[3], \"../store/userStore\");\n  var _utilsApi = require(_dependencyMap[4], \"../utils/api\");\n  var api = _interopDefault(_utilsApi);\n  var _reactJsxDevRuntime = require(_dependencyMap[5], \"react/jsx-dev-runtime\");\n  WebBrowser.maybeCompleteAuthSession();\n  const AuthContext = /*#__PURE__*/(0, _react.createContext)(undefined);\n  const AuthProvider = ({\n    children\n  }) => {\n    const {\n      setUser,\n      setLoading,\n      logout,\n      isLoading\n    } = (0, _storeUserStore.useUserStore)();\n    const [sessionId, setSessionId] = (0, _react.useState)(null);\n    (0, _react.useEffect)(() => {\n      checkExistingSession();\n    }, []);\n    const checkExistingSession = async () => {\n      try {\n        const token = await AsyncStorage.default.getItem('session_token');\n        if (token) {\n          const response = await api.default.get('/api/auth/me');\n          setUser(response.data);\n        } else {\n          setLoading(false);\n        }\n      } catch (error) {\n        console.error('Session check failed:', error);\n        await AsyncStorage.default.removeItem('session_token');\n        setLoading(false);\n      }\n    };\n    const signIn = async () => {\n      const redirectUrl = process.env.EXPO_PUBLIC_REDIRECT_URL || 'https://winwai-fix.preview.emergentagent.com';\n      const authUrl = `https://auth.emergentagent.com/?redirect=${encodeURIComponent(redirectUrl)}`;\n      try {\n        const result = await WebBrowser.openAuthSessionAsync(authUrl, redirectUrl);\n        if (result.type === 'success' && result.url) {\n          const url = new URL(result.url);\n          const hash = url.hash.substring(1);\n          const params = new URLSearchParams(hash);\n          const sid = params.get('session_id');\n          if (sid) {\n            const response = await api.default.post('/api/auth/session', {\n              session_id: sid\n            });\n            const {\n              session_token,\n              user\n            } = response.data;\n            await AsyncStorage.default.setItem('session_token', session_token);\n            setUser(user);\n          }\n        }\n      } catch (error) {\n        console.error('Sign in failed:', error);\n        throw error;\n      }\n    };\n    const signOut = async () => {\n      try {\n        // Call logout endpoint\n        await api.default.post('/api/auth/logout');\n      } catch (error) {\n        console.error('Logout API call failed:', error);\n        // Continue with local logout even if API fails\n      } finally {\n        // Always clear local state regardless of API success\n        await AsyncStorage.default.removeItem('session_token');\n        logout();\n        setLoading(false);\n      }\n    };\n    return /*#__PURE__*/(0, _reactJsxDevRuntime.jsxDEV)(AuthContext.Provider, {\n      value: {\n        signIn,\n        signOut,\n        isLoading\n      },\n      children: children\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 84,\n      columnNumber: 5\n    }, this);\n  };\n  const useAuth = () => {\n    const context = (0, _react.useContext)(AuthContext);\n    if (!context) {\n      throw new Error('useAuth must be used within AuthProvider');\n    }\n    return context;\n  };\n});","lineCount":140,"map":[[28,2,17,0,"Object"],[28,8,17,0],[28,9,17,0,"defineProperty"],[28,23,17,0],[28,24,17,0,"exports"],[28,31,17,0],[29,4,17,0,"enumerable"],[29,14,17,0],[30,4,17,0,"get"],[30,7,17,0],[30,18,17,0,"get"],[30,19,17,0],[31,6,17,0],[31,13,17,0,"AuthProvider"],[31,25,17,0],[32,4,17,0],[33,2,17,0],[34,2,90,0,"Object"],[34,8,90,0],[34,9,90,0,"defineProperty"],[34,23,90,0],[34,24,90,0,"exports"],[34,31,90,0],[35,4,90,0,"enumerable"],[35,14,90,0],[36,4,90,0,"get"],[36,7,90,0],[36,18,90,0,"get"],[36,19,90,0],[37,6,90,0],[37,13,90,0,"useAuth"],[37,20,90,0],[38,4,90,0],[39,2,90,0],[40,2,1,0],[40,6,1,0,"_react"],[40,12,1,0],[40,15,1,0,"require"],[40,22,1,0],[40,23,1,0,"_dependencyMap"],[40,37,1,0],[41,2,2,0],[41,6,2,0,"_reactNativeAsyncStorageAsyncStorage"],[41,42,2,0],[41,45,2,0,"require"],[41,52,2,0],[41,53,2,0,"_dependencyMap"],[41,67,2,0],[42,2,2,0],[42,6,2,0,"AsyncStorage"],[42,18,2,0],[42,21,2,0,"_interopDefault"],[42,36,2,0],[42,37,2,0,"_reactNativeAsyncStorageAsyncStorage"],[42,73,2,0],[43,2,3,0],[43,6,3,0,"_expoWebBrowser"],[43,21,3,0],[43,24,3,0,"require"],[43,31,3,0],[43,32,3,0,"_dependencyMap"],[43,46,3,0],[44,2,3,0],[44,6,3,0,"WebBrowser"],[44,16,3,0],[44,19,3,0,"_interopNamespace"],[44,36,3,0],[44,37,3,0,"_expoWebBrowser"],[44,52,3,0],[45,2,4,0],[45,6,4,0,"_storeUserStore"],[45,21,4,0],[45,24,4,0,"require"],[45,31,4,0],[45,32,4,0,"_dependencyMap"],[45,46,4,0],[46,2,5,0],[46,6,5,0,"_utilsApi"],[46,15,5,0],[46,18,5,0,"require"],[46,25,5,0],[46,26,5,0,"_dependencyMap"],[46,40,5,0],[47,2,5,0],[47,6,5,0,"api"],[47,9,5,0],[47,12,5,0,"_interopDefault"],[47,27,5,0],[47,28,5,0,"_utilsApi"],[47,37,5,0],[48,2,5,31],[48,6,5,31,"_reactJsxDevRuntime"],[48,25,5,31],[48,28,5,31,"require"],[48,35,5,31],[48,36,5,31,"_dependencyMap"],[48,50,5,31],[49,2,7,0,"WebBrowser"],[49,12,7,10],[49,13,7,11,"maybeCompleteAuthSession"],[49,37,7,35],[49,38,7,36],[49,39,7,37],[50,2,15,0],[50,8,15,6,"AuthContext"],[50,19,15,17],[50,35,15,20],[50,39,15,20,"createContext"],[50,45,15,33],[50,46,15,33,"createContext"],[50,59,15,33],[50,61,15,63,"undefined"],[50,70,15,72],[50,71,15,73],[51,2,17,7],[51,8,17,13,"AuthProvider"],[51,20,17,25],[51,23,17,28,"AuthProvider"],[51,24,17,29],[52,4,17,31,"children"],[53,2,17,65],[53,3,17,66],[53,8,17,71],[54,4,18,2],[54,10,18,8],[55,6,18,10,"setUser"],[55,13,18,17],[56,6,18,19,"setLoading"],[56,16,18,29],[57,6,18,31,"logout"],[57,12,18,37],[58,6,18,39,"isLoading"],[59,4,18,49],[59,5,18,50],[59,8,18,53],[59,12,18,53,"useUserStore"],[59,27,18,65],[59,28,18,65,"useUserStore"],[59,40,18,65],[59,42,18,66],[59,43,18,67],[60,4,19,2],[60,10,19,8],[60,11,19,9,"sessionId"],[60,20,19,18],[60,22,19,20,"setSessionId"],[60,34,19,32],[60,35,19,33],[60,38,19,36],[60,42,19,36,"useState"],[60,48,19,44],[60,49,19,44,"useState"],[60,57,19,44],[60,59,19,60],[60,63,19,64],[60,64,19,65],[61,4,21,2],[61,8,21,2,"useEffect"],[61,14,21,11],[61,15,21,11,"useEffect"],[61,24,21,11],[61,26,21,12],[61,32,21,18],[62,6,22,4,"checkExistingSession"],[62,26,22,24],[62,27,22,25],[62,28,22,26],[63,4,23,2],[63,5,23,3],[63,7,23,5],[63,9,23,7],[63,10,23,8],[64,4,25,2],[64,10,25,8,"checkExistingSession"],[64,30,25,28],[64,33,25,31],[64,39,25,31,"checkExistingSession"],[64,40,25,31],[64,45,25,43],[65,6,26,4],[65,10,26,8],[66,8,27,6],[66,14,27,12,"token"],[66,19,27,17],[66,22,27,20],[66,28,27,26,"AsyncStorage"],[66,40,27,38],[66,41,27,38,"default"],[66,48,27,38],[66,49,27,39,"getItem"],[66,56,27,46],[66,57,27,47],[66,72,27,62],[66,73,27,63],[67,8,28,6],[67,12,28,10,"token"],[67,17,28,15],[67,19,28,17],[68,10,29,8],[68,16,29,14,"response"],[68,24,29,22],[68,27,29,25],[68,33,29,31,"api"],[68,36,29,34],[68,37,29,34,"default"],[68,44,29,34],[68,45,29,35,"get"],[68,48,29,38],[68,49,29,39],[68,63,29,53],[68,64,29,54],[69,10,30,8,"setUser"],[69,17,30,15],[69,18,30,16,"response"],[69,26,30,24],[69,27,30,25,"data"],[69,31,30,29],[69,32,30,30],[70,8,31,6],[70,9,31,7],[70,15,31,13],[71,10,32,8,"setLoading"],[71,20,32,18],[71,21,32,19],[71,26,32,24],[71,27,32,25],[72,8,33,6],[73,6,34,4],[73,7,34,5],[73,8,34,6],[73,15,34,13,"error"],[73,20,34,18],[73,22,34,20],[74,8,35,6,"console"],[74,15,35,13],[74,16,35,14,"error"],[74,21,35,19],[74,22,35,20],[74,45,35,43],[74,47,35,45,"error"],[74,52,35,50],[74,53,35,51],[75,8,36,6],[75,14,36,12,"AsyncStorage"],[75,26,36,24],[75,27,36,24,"default"],[75,34,36,24],[75,35,36,25,"removeItem"],[75,45,36,35],[75,46,36,36],[75,61,36,51],[75,62,36,52],[76,8,37,6,"setLoading"],[76,18,37,16],[76,19,37,17],[76,24,37,22],[76,25,37,23],[77,6,38,4],[78,4,39,2],[78,5,39,3],[79,4,41,2],[79,10,41,8,"signIn"],[79,16,41,14],[79,19,41,17],[79,25,41,17,"signIn"],[79,26,41,17],[79,31,41,29],[80,6,42,4],[80,12,42,10,"redirectUrl"],[80,23,42,21],[80,26,42,24,"process"],[80,33,42,31],[80,34,42,32,"env"],[80,37,42,35],[80,38,42,36,"EXPO_PUBLIC_REDIRECT_URL"],[80,62,42,60],[80,66,42,64],[80,118,42,116],[81,6,43,4],[81,12,43,10,"authUrl"],[81,19,43,17],[81,22,43,20],[81,66,43,64,"encodeURIComponent"],[81,84,43,82],[81,85,43,83,"redirectUrl"],[81,96,43,94],[81,97,43,95],[81,99,43,97],[82,6,45,4],[82,10,45,8],[83,8,46,6],[83,14,46,12,"result"],[83,20,46,18],[83,23,46,21],[83,29,46,27,"WebBrowser"],[83,39,46,37],[83,40,46,38,"openAuthSessionAsync"],[83,60,46,58],[83,61,46,59,"authUrl"],[83,68,46,66],[83,70,46,68,"redirectUrl"],[83,81,46,79],[83,82,46,80],[84,8,48,6],[84,12,48,10,"result"],[84,18,48,16],[84,19,48,17,"type"],[84,23,48,21],[84,28,48,26],[84,37,48,35],[84,41,48,39,"result"],[84,47,48,45],[84,48,48,46,"url"],[84,51,48,49],[84,53,48,51],[85,10,49,8],[85,16,49,14,"url"],[85,19,49,17],[85,22,49,20],[85,26,49,24,"URL"],[85,29,49,27],[85,30,49,28,"result"],[85,36,49,34],[85,37,49,35,"url"],[85,40,49,38],[85,41,49,39],[86,10,50,8],[86,16,50,14,"hash"],[86,20,50,18],[86,23,50,21,"url"],[86,26,50,24],[86,27,50,25,"hash"],[86,31,50,29],[86,32,50,30,"substring"],[86,41,50,39],[86,42,50,40],[86,43,50,41],[86,44,50,42],[87,10,51,8],[87,16,51,14,"params"],[87,22,51,20],[87,25,51,23],[87,29,51,27,"URLSearchParams"],[87,44,51,42],[87,45,51,43,"hash"],[87,49,51,47],[87,50,51,48],[88,10,52,8],[88,16,52,14,"sid"],[88,19,52,17],[88,22,52,20,"params"],[88,28,52,26],[88,29,52,27,"get"],[88,32,52,30],[88,33,52,31],[88,45,52,43],[88,46,52,44],[89,10,54,8],[89,14,54,12,"sid"],[89,17,54,15],[89,19,54,17],[90,12,55,10],[90,18,55,16,"response"],[90,26,55,24],[90,29,55,27],[90,35,55,33,"api"],[90,38,55,36],[90,39,55,36,"default"],[90,46,55,36],[90,47,55,37,"post"],[90,51,55,41],[90,52,55,42],[90,71,55,61],[90,73,55,63],[91,14,55,65,"session_id"],[91,24,55,75],[91,26,55,77,"sid"],[92,12,55,81],[92,13,55,82],[92,14,55,83],[93,12,56,10],[93,18,56,16],[94,14,56,18,"session_token"],[94,27,56,31],[95,14,56,33,"user"],[96,12,56,38],[96,13,56,39],[96,16,56,42,"response"],[96,24,56,50],[96,25,56,51,"data"],[96,29,56,55],[97,12,58,10],[97,18,58,16,"AsyncStorage"],[97,30,58,28],[97,31,58,28,"default"],[97,38,58,28],[97,39,58,29,"setItem"],[97,46,58,36],[97,47,58,37],[97,62,58,52],[97,64,58,54,"session_token"],[97,77,58,67],[97,78,58,68],[98,12,59,10,"setUser"],[98,19,59,17],[98,20,59,18,"user"],[98,24,59,22],[98,25,59,23],[99,10,60,8],[100,8,61,6],[101,6,62,4],[101,7,62,5],[101,8,62,6],[101,15,62,13,"error"],[101,20,62,18],[101,22,62,20],[102,8,63,6,"console"],[102,15,63,13],[102,16,63,14,"error"],[102,21,63,19],[102,22,63,20],[102,39,63,37],[102,41,63,39,"error"],[102,46,63,44],[102,47,63,45],[103,8,64,6],[103,14,64,12,"error"],[103,19,64,17],[104,6,65,4],[105,4,66,2],[105,5,66,3],[106,4,68,2],[106,10,68,8,"signOut"],[106,17,68,15],[106,20,68,18],[106,26,68,18,"signOut"],[106,27,68,18],[106,32,68,30],[107,6,69,4],[107,10,69,8],[108,8,70,6],[109,8,71,6],[109,14,71,12,"api"],[109,17,71,15],[109,18,71,15,"default"],[109,25,71,15],[109,26,71,16,"post"],[109,30,71,20],[109,31,71,21],[109,49,71,39],[109,50,71,40],[110,6,72,4],[110,7,72,5],[110,8,72,6],[110,15,72,13,"error"],[110,20,72,18],[110,22,72,20],[111,8,73,6,"console"],[111,15,73,13],[111,16,73,14,"error"],[111,21,73,19],[111,22,73,20],[111,47,73,45],[111,49,73,47,"error"],[111,54,73,52],[111,55,73,53],[112,8,74,6],[113,6,75,4],[113,7,75,5],[113,16,75,14],[114,8,76,6],[115,8,77,6],[115,14,77,12,"AsyncStorage"],[115,26,77,24],[115,27,77,24,"default"],[115,34,77,24],[115,35,77,25,"removeItem"],[115,45,77,35],[115,46,77,36],[115,61,77,51],[115,62,77,52],[116,8,78,6,"logout"],[116,14,78,12],[116,15,78,13],[116,16,78,14],[117,8,79,6,"setLoading"],[117,18,79,16],[117,19,79,17],[117,24,79,22],[117,25,79,23],[118,6,80,4],[119,4,81,2],[119,5,81,3],[120,4,83,2],[120,24,84,4],[120,28,84,4,"_reactJsxDevRuntime"],[120,47,84,4],[120,48,84,4,"jsxDEV"],[120,54,84,4],[120,56,84,5,"AuthContext"],[120,67,84,16],[120,68,84,17,"Provider"],[120,76,84,25],[121,6,84,26,"value"],[121,11,84,31],[121,13,84,33],[122,8,84,35,"signIn"],[122,14,84,41],[123,8,84,43,"signOut"],[123,15,84,50],[124,8,84,52,"isLoading"],[125,6,84,62],[125,7,84,64],[126,6,84,64,"children"],[126,14,84,64],[126,16,85,7,"children"],[127,4,85,15],[128,6,85,15,"fileName"],[128,14,85,15],[128,16,85,15,"_jsxFileName"],[128,28,85,15],[129,6,85,15,"lineNumber"],[129,16,85,15],[130,6,85,15,"columnNumber"],[130,18,85,15],[131,4,85,15],[131,11,86,26],[131,12,86,27],[132,2,88,0],[132,3,88,1],[133,2,90,7],[133,8,90,13,"useAuth"],[133,15,90,20],[133,18,90,23,"useAuth"],[133,19,90,23],[133,24,90,29],[134,4,91,2],[134,10,91,8,"context"],[134,17,91,15],[134,20,91,18],[134,24,91,18,"useContext"],[134,30,91,28],[134,31,91,28,"useContext"],[134,41,91,28],[134,43,91,29,"AuthContext"],[134,54,91,40],[134,55,91,41],[135,4,92,2],[135,8,92,6],[135,9,92,7,"context"],[135,16,92,14],[135,18,92,16],[136,6,93,4],[136,12,93,10],[136,16,93,14,"Error"],[136,21,93,19],[136,22,93,20],[136,64,93,62],[136,65,93,63],[137,4,94,2],[138,4,95,2],[138,11,95,9,"context"],[138,18,95,16],[139,2,96,0],[139,3,96,1],[140,0,96,2],[140,3]],"functionMap":{"names":["<global>","AuthProvider","useEffect$argument_0","checkExistingSession","signIn","signOut","useAuth"],"mappings":"AAA;4BCgB;YCI;GDE;+BEE;GFc;iBGE;GHyB;kBIE;GJa;CDO;uBME;CNM"},"hasCjsExports":false},"type":"js/module"}]}